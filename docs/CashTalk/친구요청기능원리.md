# ğŸ‘¥ ì¹œêµ¬ ìš”ì²­ ê¸°ëŠ¥ ì •ë³´ ì •ë¦¬ (Spring Boot + Flutter)

## âœ¨ ë‹¤ìŒ ìœ ì € ì‚¬ì´ ì°¸ì¡° ì „ì²´ í™”ë¥˜

**ìœ ì € Aê°€ ìœ ì € Bì—ê²Œ ì¹œêµ¬ ìš”ì²­ ë³´ë‚´ê³ , Bê°€ ìˆ˜ë½í•˜ëŠ” ê¸°ëŠ¥ ì „ì²´ í™œì„±í™” ê´€ë ¨ ê¸°ëŠ¥ëª…ì„ í‘œë³´ë¡œ ì •ë³´í™”.**

---

## íŒ¨í„´ ê°œìš”

| ê¸°ëŠ¥ | HTTP | URI | Flutter Method |
|--------|------|-----|----------------|
| ì¹œêµ¬ ìš”ì²­ ë³´ë‚´ê¸° | POST | `/api/friends/requests/send` | `sendFriendRequest(receiverId)` |
| ë°›ì€ ì¹œêµ¬ ìš”ì²­ ëª©ë¡ | GET | `/api/friends/requests/received` | `getReceivedRequests()` |
| ë³´ë‚´ëœ ì¹œêµ¬ ìš”ì²­ ëª©ë¡ | GET | `/api/friends/requests/sent` | `getSentRequests()` |
| ìš”ì²­ ìˆ˜ë½ | POST | `/api/friends/requests/accept` | `acceptFriendRequest(senderId)` |
| ìš”ì²­ ê±°ì ˆ | POST | `/api/friends/requests/reject` | `rejectFriendRequest(senderId)` |

---

## íŒ¨í„´ ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### íšŒì› `user` í…Œì´ë¸”
- ìœ ì € ê¸°ë³¸ ì •ë³´ ì €ì¥ (id, nickname, inviteCode, email, ...)

### ì¹œêµ¬ ìš”ì²­ `friend_request`
| í•„ë“œ | ì„¤ëª… |
|--------|--------|
| id | ìš”ì²­ ID |
| sender_id | ìš”ì²­ ë³´ë‚´ëŠ” ìœ ì € |
| receiver_id | ìš”ì²­ ë°›ëŠ” ìœ ì € |
| created_at | ìš”ì²­ ì‹œê°„ |
| accepted | ìˆ˜ë½ ìœ ë¬´ (false: ë¬´ì ì‹œ, ì œê±° ì¤‘ì‹œê°„ì ) |

### ì¹œêµ¬ `friends`
- ì¹œêµ¬ ê´€ê³„ ì €ì¥ (Aâ†’B, Bâ†’A ìƒë°˜ì ìœ¼ë¡œ ì €ì¥)

---

## âš¡ï¸ ê¸°ëŠ¥ë³„ ê´€ë ¨ í™œì„±í™” í™”ë¥˜

### 1. ì¹œêµ¬ ìš”ì²­ ë³´ë‚´ê¸°
```http
POST /api/friends/requests/send
Authorization: Bearer {token}
Content-Type: application/json

{
  "receiverId": 7
}
```
- sender == ë¡œê·¸ì¸ëœ ìœ ì €
- DBì— `friend_request(sender, receiver)` ì €ì¥

### 2. ë°›ì€ ì¹œêµ¬ ìš”ì²­ ëª©ë¡ ì¡°íšŒ
```http
GET /api/friends/requests/received
Authorization: Bearer {token}
```
- receiver == ë¡œê·¸ì¸ëœ ìœ ì €
- ì‘ë‹µ í˜•íƒœ (FriendRequestDto):
```json
[
  {
    "requestId": 17,
    "userId": 7,
    "nickname": "í™ê¸¸ë™",
    "profileImage": null,
    "sentByMe": false,
    "createdAt": "2025-04-15T15:20:00"
  }
]
```

### 3. ë³´ë‚´ëœ ì¹œêµ¬ ìš”ì²­ ëª©ë¡ ì¡°íšŒ
```http
GET /api/friends/requests/sent
Authorization: Bearer {token}
```
- sender == ë¡œê·¸ì¸ëœ ìœ ì €
- ì‘ë‹µ êµ¬ì¡° ë™ì¼, `sentByMe: true`

### 4. ìš”ì²­ ìˆ˜ë½
```http
POST /api/friends/requests/accept
Authorization: Bearer {token}
Content-Type: application/json

{
  "senderId": 3
}
```
- ì¡°ê±´ ê²€ì‚¬ â†’ ì¹œêµ¬ insert (ìŒë°©) â†’ friend_request ì‚­ì œ

### 5. ìš”ì²­ ê±°ì ˆ
```http
POST /api/friends/requests/reject
Authorization: Bearer {token}
Content-Type: application/json

{
  "senderId": 3
}
```
- ë‹¨ìˆœíˆ `friend_request` ì‚­ì œ

---

## ğŸ” JWT ì¸ì¦ ì²˜ë¦¬ëŠ”?
- `@AuthenticationPrincipal CustomUserDetails` ì„ í†µí•´ í˜„ì¬ ë¡œê·¸ì¸ ìœ ì € ì°¾ìŒ
- token â†’ email í†µí•œ ìœ ì € ë¡œë“œ â†’ Service ë³€ìˆ˜ì— ëŒ€ì…

---

## íŒŒì´ë„ í™œì„±í™” í†µê³¼
```text
Flutter
  â†’ [POST] /requests/send          â†’ DBê°€ friend_request insert
  â†’ [GET]  /requests/received      â†’ ë°›ì€ ìš”ì²­
  â†’ [GET]  /requests/sent          â†’ ë³´ë‚´ëœ ìš”ì²­
  â†’ [POST] /requests/accept        â†’ friends 2ê°œ insert + ìš”ì²­ delete
  â†’ [POST] /requests/reject        â†’ ìš”ì²­ delete
```

---

## í™•ì¸ ì²´í¬ë¦½ì„œ

| í•­ëª© | êµ¬í˜„ì—¬ë¶€ | ì„¤ëª… |
|------|-----------|------|
| DB í…Œì´ë¸” | âœ”ï¸ | user, friend_request, friends êµ¬ì¡° ê±´ì„¤ |
| API ì˜¤í”ˆ | âœ”ï¸ | Controller + Service + Repository ì „ì²´ êµ¬í˜„ |
| DTO | âœ”ï¸ | FriendRequestDto í†µí•œ ì—°ê²° |
| ìœ ì € ì°¾ê¸° | âœ”ï¸ | JWT ë¥¼ ì´ìš©í•œ ë¡œê·¸ì¸ ì‚¬ìš©ì ì°¾ê¸° |
| í”„ë¡ íŠ¸ POST/GET | âœ”ï¸ | json + bearer token ë°”ì´ë” |

---

