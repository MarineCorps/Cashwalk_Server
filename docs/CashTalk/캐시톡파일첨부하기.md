# ğŸ–¼ï¸ ì±„íŒ… ì´ë¯¸ì§€ / íŒŒì¼ ì „ì†¡ ê¸°ëŠ¥ êµ¬í˜„ ì •ë¦¬

ğŸ“… ë‚ ì§œ: 2025-04-13

---

## âœ… êµ¬í˜„ ëª©í‘œ

ì‚¬ìš©ìê°€ ì±„íŒ…ë°©ì—ì„œ ì´ë¯¸ì§€ ë˜ëŠ” íŒŒì¼ì„ ì—…ë¡œë“œí•˜ê³ ,  
í•´ë‹¹ íŒŒì¼ì„ í¬í•¨í•œ ë©”ì‹œì§€ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì£¼ê³ ë°›ì„ ìˆ˜ ìˆë„ë¡ WebSocket êµ¬ì¡°ì™€ ì—°ê³„í•¨.

---

## ğŸ“‚ ìƒì„±/ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

| ë””ë ‰í† ë¦¬ | íŒŒì¼ëª… | ì—­í•  |
|----------|--------|------|
| `controller` | `ChatController.java` | íŒŒì¼ ì—…ë¡œë“œ API ì¶”ê°€ (`/api/chat/upload`) |
| `controller` | `ChatWebSocketController.java` | ì´ë¯¸ì§€/íŒŒì¼ ë©”ì‹œì§€ ì „ì†¡ ì²˜ë¦¬ |
| `entity` | `ChatMessage.java` | `type`, `fileUrl` í•„ë“œ ì¶”ê°€ (TEXT, IMAGE, FILE) |
| `dto` | `ChatMessageDto.java` | ë©”ì‹œì§€ ì „ì†¡ DTOì— `type`, `fileUrl` í¬í•¨ |
| `dto` | `ChatMessageResponseDto.java` | ëª©ë¡ ì¡°íšŒìš© ì‘ë‹µ DTO |
| `config` | `WebConfig.java` | `/uploads/**` ì •ì  íŒŒì¼ ì ‘ê·¼ ê²½ë¡œ ì„¤ì • |
| `repository` | `ChatMessageRepository.java` | ì‹œê°„ìˆœ ì •ë ¬ ì¿¼ë¦¬ ì¶”ê°€ |
| `service` | `ChatService.java` | ë©”ì‹œì§€ ì¡°íšŒ ë¡œì§ ì¶”ê°€ |

---

## âœ… ì „ì²´ íë¦„ ìš”ì•½

### ğŸ” ì´ë¯¸ì§€ ë©”ì‹œì§€ ì „ì†¡ ì ˆì°¨

1. Flutter â†’ `POST /api/chat/upload` â†’ ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ
2. ì‘ë‹µ: `{ fileUrl: "/uploads/chat/uuid_íŒŒì¼ëª….jpg" }`
3. Flutter â†’ WebSocket ë©”ì‹œì§€ ì „ì†¡ (fileUrl í¬í•¨)
4. ì„œë²„ â†’ ë©”ì‹œì§€ ì €ì¥ + ì‹¤ì‹œê°„ ìƒëŒ€ë°© ì „ì†¡

---

## âœ… ë©”ì‹œì§€ íƒ€ì…

| íƒ€ì… | ì„¤ëª… |
|------|------|
| TEXT | ì¼ë°˜ í…ìŠ¤íŠ¸ |
| IMAGE | ì´ë¯¸ì§€ ì²¨ë¶€ ë©”ì‹œì§€ |
| FILE | ë¬¸ì„œ ì²¨ë¶€ ë©”ì‹œì§€ |

---

## âœ… ë©”ì‹œì§€ ëª©ë¡ ì¡°íšŒ API

- `GET /api/chat/messages/{roomId}`
- ì‘ë‹µ ì˜ˆì‹œ:
```json
{
  "messageId": 12,
  "senderId": 2,
  "content": "ì‚¬ì§„ ì²¨ë¶€í•©ë‹ˆë‹¤!",
  "fileUrl": "/uploads/chat/uuid_íŒŒì¼.jpg",
  "type": "IMAGE",
  "createdAt": "2025-04-13T12:34:56"
}
```

---

## âœ… WebConfig ì„¤ì •

```java
registry.addResourceHandler("/uploads/**")
        .addResourceLocations("file:" + System.getProperty("user.dir") + "/uploads/");
```

â†’ `/uploads/chat/íŒŒì¼ëª…` ìœ¼ë¡œ URL ì ‘ê·¼ ê°€ëŠ¥

---

## âœ… Flutter ì—°ë™ ì˜ˆì‹œ íë¦„

1. ì´ë¯¸ì§€ ì„ íƒ (`ImagePicker`)
2. `MultipartRequest`ë¡œ `/api/chat/upload` í˜¸ì¶œ
3. ì‘ë‹µë°›ì€ fileUrl í¬í•¨ WebSocket ë©”ì‹œì§€ ì „ì†¡
4. ìƒëŒ€ë°©ì—ê²Œ ì‹¤ì‹œê°„ ë©”ì‹œì§€ ì „ì†¡ â†’ ì´ë¯¸ì§€ ì¶œë ¥
5. `senderId == myId` ì¡°ê±´ìœ¼ë¡œ ì¢Œ/ìš° ì •ë ¬ ì²˜ë¦¬

---

## âœ… ì˜ˆì‹œ ë¶„ê¸° ë¡œì§ (Flutter)

```dart
if (message.senderId == myId) {
  // ì˜¤ë¥¸ìª½ ë§í’ì„  (ë‚´ ë©”ì‹œì§€)
} else {
  // ì™¼ìª½ ë§í’ì„  (ìƒëŒ€ ë©”ì‹œì§€)
}
```

---

## âœ… í…ŒìŠ¤íŠ¸ ë°©ë²• ìš”ì•½

| í…ŒìŠ¤íŠ¸ í•­ëª© | ë°©ë²• |
|-------------|------|
| ì—…ë¡œë“œ | Flutter `MultipartRequest` ë˜ëŠ” Postman |
| WebSocket ì „ì†¡ | Flutter WebSocket ì‚¬ìš© |
| ì¶œë ¥ í™•ì¸ | `Image.network(message.fileUrl)` |

---

## âœ… ë§ˆë¬´ë¦¬

ì±„íŒ… ê¸°ëŠ¥ì— ì´ë¯¸ì§€/íŒŒì¼ ì „ì†¡ì„ ì™„ì „ í†µí•©.  
WebSocket + íŒŒì¼ ì—…ë¡œë“œ íë¦„ì„ ë¶„ë¦¬ ì²˜ë¦¬í•˜ì—¬ ì•ˆì •ì„± í™•ë³´.  
Flutterì—ì„œë„ ì¢Œ/ìš° ì±„íŒ… UIë¡œ í‘œí˜„ ê°€ëŠ¥.
