# β… μ¶μ„ μ΄λ²¤νΈ λ³΄μƒ API κ°λ° κΈ°λ΅

- **λ‚ μ§**: 2025-04-05
- **κΈ°λ¥ μ”μ•½**: μ‚¬μ©μκ°€ `/api/events/attendance`μ— POST μ”μ²­μ„ λ³΄λ‚΄λ©΄, ν•λ£¨μ— ν• λ²λ§ μ¶μ„μ΄ κ°€λ¥ν•κ³  10 ν¬μΈνΈκ°€ μ λ¦½λλ” μ¶μ„ μ΄λ²¤νΈ API κµ¬ν„
- **κµ¬ν„ λ©ν‘**: μ¤‘λ³µ μ¶μ„ λ°©μ§€ + ν¬μΈνΈ μ λ¦½ + ν¬μΈνΈ μ΄λ ¥ κΈ°λ΅ + JWT μΈμ¦ κΈ°λ° μ μ € μ‹λ³„

---

## π“ λ””λ ‰ν† λ¦¬λ³„ μ—­ν•  μ”μ•½

| λ””λ ‰ν† λ¦¬ | μ„¤λ… |
|----------|------|
| `controller` | ν΄λΌμ΄μ–ΈνΈ μ”μ²­ μμ‹  λ° μ‘λ‹µ λ°ν™ (EventsController) |
| `service` | μ¶μ„ μ¤‘λ³µ μ—¬λ¶€ ν™•μΈ λ° ν¬μΈνΈ μ λ¦½ μ²λ¦¬ (EventsService) |
| `repository` | μ¶μ„ μ΄λ²¤νΈ μ°Έμ—¬ μ—¬λ¶€ ν™•μΈ (PointsRepository) |
| `security` | JWT μΈμ¦ ν•„ν„°λ¥Ό ν†µν•΄ μ‚¬μ©μ μΈμ¦ μ²λ¦¬ |
| `entity` | Points μ—”ν‹°ν‹°λ¥Ό ν†µν•΄ μ¶μ„ μ΄λ²¤νΈ μ΄λ ¥ μ €μ¥ |
| `utils` | λ‚ μ§ λΉ„κµλ¥Ό μ„ν• μ ν‹Έ ν•¨μ μ‚¬μ© κ°€λ¥ |
| `config` | `/api/events/**` κ²½λ΅λ” μΈμ¦λ μ‚¬μ©μλ§ μ ‘κ·Ό κ°€λ¥ν•λ„λ΅ Security μ„¤μ • |

---

## π›  μμ • λ° μƒμ„±ν• μ£Όμ” νμΌ λ©λ΅

- `EventsController.java`
- `EventsService.java`
- `PointsService.java` (λ‚΄λ¶€ λ΅μ§ μμ •)
- `SecurityConfig.java` (μ¶μ„ μ΄λ²¤νΈ μ”μ²­ κ²½λ΅ μΈμ¦ ν—μ© μ¶”κ°€)

---

## π” μ „μ²΄ νλ¦„ μ”μ•½

1. μ‚¬μ©μκ°€ λ΅κ·ΈμΈ ν›„ JWTλ¥Ό ν¬ν•¨ν•μ—¬ `/api/events/attendance`λ΅ POST μ”μ²­
2. `EventsController`μ—μ„ `EventsService` νΈμ¶
3. `EventsService`μ—μ„ μ¤λ μ¶μ„ν–λ”μ§€ ν™•μΈ β†’ `PointsRepository.findByUserAndTypeAndDate()`
4. μ¶μ„ μ΄λ ¥μ΄ μ—†μΌλ©΄ ν¬μΈνΈ μ λ¦½ β†’ `PointsService.addReward()`
5. `PointsService.addReward()`λ” μ μ €μ ν¬μΈνΈλ¥Ό μ¦κ°€μ‹ν‚¤κ³  ν¬μΈνΈ λ‚΄μ—­ μ €μ¥
6. μ¶μ„ μ™„λ£ μ‘λ‹µ λ°ν™, μ¤‘λ³µ μ‹ 400 μ‘λ‹µ

---

## π§ ν…μ¤νΈ λ°©λ²•

### β… μ¶μ„ μ„±κ³µ

```
POST /api/events/attendance
Authorization: Bearer [JWT_ACCESS_TOKEN]

β†’ μ‘λ‹µ: 200 OK
{ 
  "message": "μ¶μ„ λ³΄μƒμ΄ μ§€κΈ‰λμ—μµλ‹λ‹¤." 
}
```

### β μ¤‘λ³µ μ¶μ„

```
POST /api/events/attendance
Authorization: Bearer [JWT_ACCESS_TOKEN]

β†’ μ‘λ‹µ: 400 Bad Request
{ 
  "error": "μ΄λ―Έ μ¤λ μ¶μ„ν–μµλ‹λ‹¤.",
  "code": 400 
}
```

---

## β… DB ν™•μΈ (μ¶μ„ μ΄λ ¥ μ €μ¥λ¨)

```sql
SELECT * FROM points WHERE user_id = ? AND type = 'ATTENDANCE';
```

---

## π” Spring Security μ„¤μ • μ”μ•½

```java
.requestMatchers("/api/events/**").authenticated()
```

- μΈμ¦λ μ‚¬μ©μλ§ μ¶μ„ μ΄λ²¤νΈ μ ‘κ·Ό κ°€λ¥
- λ‹¤λ¥Έ POST μ”μ²­λ“¤κ³Ό λ‹¬λ¦¬ `HttpMethod.POST`λ¥Ό λ…μ‹ν•μ§€ μ•μ€ μ΄μ λ” GET/POST κµ¬λ¶„ μ—†μ΄ `/api/events/**` μ „μ²΄μ— μΈμ¦μ„ μ μ©ν•κΈ° μ„ν•¨

---

## π“ λ°°μ΄ μ  / μ£Όμν•  μ 

- `findById()` κ°™μ€ JPA ν•¨μλ” λ³΄ν†µ `repository`μ— μ„ μ–Έν•΄μ„ μ‚¬μ©
- ν¬μΈνΈ μ λ¦½ μ‹ `user.getPoints()` λ“±μ„ μ‚¬μ©ν•  λ• `user`κ°€ nullμΌ μ μμΌλ―€λ΅ κΌ­ null μ²΄ν¬ λλ” μ μ ν• μμ™Έ μ²λ¦¬λ¥Ό ν•΄μ¤μ•Ό ν•¨
- JWT ν† ν° μ—†μ΄ ν…μ¤νΈν•λ©΄ `403 Forbidden` λλ” μΈμ¦ μ¤λ¥ λ°μƒ

---
