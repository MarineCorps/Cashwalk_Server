
# ğŸ’¬ ì»¤ë®¤ë‹ˆí‹° ì „ì²´ íë¦„ ì •ë¦¬ (Flutter â†” Spring Boot)

---

## 1. ğŸ“± ê²Œì‹œê¸€ ìƒì„¸ì¡°íšŒ + ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ

### âœ… ì‚¬ìš© ì‹œì :
- Flutterì—ì„œ `PostDetailPage` ì§„ì… ì‹œ
- ë°±ì—”ë“œ API: `GET /api/community/posts/{postId}`

### ğŸ” ì „ì²´ íë¦„:
```
Flutter
 â””â–¶ CommunityService.getPostDetail(postId)
      â””â–¶ GET /api/community/posts/{postId}
          â””â–¶ CommunityController.getPostDetail()
              â””â–¶ CommunityService.getPostDetail()
                  â”œâ–¶ postRepository.findWithUserById()
                  â”œâ–¶ viewCountService.increaseIfNotDuplicate()
                  â”œâ–¶ commentService.getCommentsByPostId()
                  â””â–¶ postLikeRepository, bookmarkRepository ë“± ì¡°íšŒ
                      â””â–¶ PostDetailResponseDto ë¦¬í„´
```

### ğŸ“Œ ì£¼ìš” ì½”ë“œ ì˜ˆì‹œ:

#### Flutter: `community_service.dart`
```dart
static Future<Map<String, dynamic>> fetchPostDetail(int postId) async {
  final response = await getJson('/api/community/posts/$postId');
  return response;
}
```

#### Controller: `CommunityController.java`
```java
@GetMapping("/posts/{postId}")
public PostDetailResponseDto getPostDetail(@PathVariable Long postId, @CurrentUserId Long currentUserId) {
    return communityService.getPostDetail(postId, currentUserId);
}
```

#### Service: `CommunityService.java`
```java
List<CommentResponseDto> commentDtos = commentService.getCommentsByPostId(postId, currentUserId);
boolean likedByMe = likeOptional.map(l -> l.getStatus() == LIKE).orElse(false);
return PostDetailResponseDto.builder()
  .comments(commentDtos)
  .likedByMe(likedByMe)
  .dislikedByMe(dislikedByMe)
  .isMine(post.getUser().getId().equals(currentUserId))
  ...
```

---

## 2. ğŸ’¬ ëŒ“ê¸€/ëŒ€ëŒ“ê¸€ ì‘ì„±

### âœ… ì‚¬ìš© ì‹œì :
- ì¼ë°˜ ëŒ“ê¸€: ëŒ“ê¸€ ì‘ì„±ì°½
- ëŒ€ëŒ“ê¸€: ë‹µê¸€ ë²„íŠ¼ ëˆ„ë¥¼ ì‹œ

### ğŸ” íë¦„:
```
Flutter
 â””â–¶ CommentService.createComment(postId, content, parentId)
     â””â–¶ POST /api/community/posts/{postId}/comments
         â””â–¶ CommentController.createComment()
             â””â–¶ CommentService.createComment()
                 â””â–¶ commentRepository.save()
```

### ğŸ“Œ ì£¼ìš” ì½”ë“œ ì˜ˆì‹œ:

#### Flutter:
```dart
await CommentService.createComment(postId, content);
await CommentService.createReply(postId, content, parentId);
```

#### Controller: `CommentController.java`
```java
@PostMapping("/posts/{postId}/comments")
public CommentResponseDto createComment(@PathVariable Long postId,
                                        @RequestBody CommentRequestDto dto,
                                        @CurrentUserId Long userId) {
    return commentService.createComment(postId, userId, dto.getContent(), dto.getParentId());
}
```

#### Service: `CommentService.java`
```java
Comment comment = Comment.builder()
  .post(post)
  .user(user)
  .content(content)
  .parent(parentComment)  // ëŒ€ëŒ“ê¸€ì´ë©´ ë¶€ëª¨ ì„¸íŒ…
  .build();
commentRepository.save(comment);
```

---

## 3. ğŸ‘ ëŒ“ê¸€ ì¢‹ì•„ìš”/ì‹«ì–´ìš”

### âœ… ì‚¬ìš© ì‹œì :
- ì¢‹ì•„ìš” / ì‹«ì–´ìš” ë²„íŠ¼ í„°ì¹˜ ì‹œ

### ğŸ” íë¦„:
```
Flutter
 â””â–¶ toggleCommentReaction(commentId, "like"/"dislike")
     â””â–¶ POST /api/community/comments/comment/{id}/like
         â””â–¶ CommentController.likeComment()
             â””â–¶ CommentService.likeComment()
```

---

## 4. ğŸ› ï¸ ëŒ“ê¸€ ìˆ˜ì • / ì‚­ì œ

### âœ… ì‚¬ìš© ì‹œì :
- ë‚´ê°€ ì“´ ëŒ“ê¸€ì˜ ë”ë³´ê¸°(â‹®) â†’ ìˆ˜ì • / ì‚­ì œ ì„ íƒ

### ğŸ” íë¦„:
```
Flutter
 â””â–¶ updateComment(commentId, newContent)
 â””â–¶ deleteComment(commentId)
     â””â–¶ PUT /api/community/comments/{id}
     â””â–¶ DELETE /api/community/comments/{id}
         â””â–¶ CommentController â†’ CommentService
```

---

## 5. ğŸš« ì°¨ë‹¨ ìœ ì € í•„í„°ë§

### âœ… ì‚¬ìš© ì‹œì :
- ëŒ“ê¸€/ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ ì‹œ ì°¨ë‹¨í•œ ìœ ì € ì œì™¸

### ğŸ” íë¦„:
```
â†’ CommentService.getCommentsByPostId()
  â†’ userBlockRepository.findBlockedUserIdsByBlockerId(currentUserId)
  â†’ Stream.filter()ë¡œ ì œì™¸
```

---

## ğŸ”š ì •ë¦¬ ìš”ì•½

| ê¸°ëŠ¥ | ê²½ë¡œ | í•µì‹¬ DTO | ì£¼ìš” í´ë˜ìŠ¤ |
|------|------|----------|--------------|
| ê²Œì‹œê¸€ ìƒì„¸ì¡°íšŒ | `/api/community/posts/{postId}` | `PostDetailResponseDto` | `CommunityController` â†’ `CommunityService` |
| ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ | ë‚´ë¶€ì ìœ¼ë¡œ í•¨ê»˜ ë°˜í™˜ | `CommentResponseDto` | `CommentService.getCommentsByPostId()` |
| ëŒ“ê¸€ ì‘ì„± | `POST /posts/{postId}/comments` | `CommentRequestDto` â†’ `CommentResponseDto` | `CommentService.createComment()` |
| ëŒ“ê¸€ ì¢‹ì•„ìš” | `POST /comments/comment/{id}/like` | ì—†ìŒ | `CommentService.likeComment()` |
| ëŒ“ê¸€ ìˆ˜ì • | `PUT /comments/{id}` | `CommentUpdateRequestDto` â†’ `CommentResponseDto` | `CommentService.updateComment()` |
| ëŒ“ê¸€ ì‚­ì œ | `DELETE /comments/{id}` | ì—†ìŒ | `CommentService.deleteComment()` |
| ì°¨ë‹¨ ìœ ì € ì œì™¸ | ë‚´ë¶€ ì²˜ë¦¬ | ì—†ìŒ | `userBlockRepository.findBlockedUserIds...` |
